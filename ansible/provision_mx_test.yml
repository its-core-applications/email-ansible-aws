---

- hosts: localhost
  become: false
  tasks:
    - import_role:
        name: ec2_launch
      vars:
        launch_class: mx-test
        launch_ami_class: base
        launch_groups:
          - mx-elb
        launch_tags:
          Status: development

- import_playbook: mx_test.yml

- hosts: localhost
  become: false
  tasks:
    - name: Set mx-test.{{ aws_region }}.{{ subd }}
      route53:
        profile: "{{ aws_profile_subd }}"
        command: "create"
        overwrite: true
        zone: "{{ subd }}"
        record: mx-test.{{ aws_region }}.{{ subd }}
        type: A
        ttl: 60
        value: "{{ groups.Class_mx_test | intersect(aws_region_group) | map('extract', hostvars, 'public_ip_address') | list }}"

