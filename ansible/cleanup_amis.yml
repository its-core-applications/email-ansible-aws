- hosts: localhost
  gather_facts: false
  become: false
  tasks:
    - name: Clean up each type of image
      include_role:
        name: ec2_ami_cleanup
      vars:
        bad_classes:
          - covid_relay
          - ctools_mx
          - junk
          - odm
          - rbl
        good_classes:
          - authn_relay
          - authz_relay
          - base
          - dnsbl
          - egress
          - jail
          - mx
          - relay
          - relay_egress
        image_retain: "{{ (image_type in bad_classes) | ternary(0, 4) }}"
      loop: "{{ good_classes | union(bad_classes) }}"
      loop_control:
        loop_var: image_type

    - include_role:
        name: ec2_ami_cleanup
      vars:
        aws_profile: "{{ aws_profiles[aws_status]['vdc-core'] }}"
        image_type: vdc_relay
        image_retain: 2
