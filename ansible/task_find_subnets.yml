---

- name: Gather VPC subnet facts
  delegate_to: localhost
  become: false
  ec2_vpc_subnet_facts:
    region: "{{ aws_region }}"
    filters:
      vpc-id: "{{ play_vpc | default(aws_vpc) }}"
  register: ec2_subnet_facts

- name: Shuffle and sort subnets
  set_fact:
    ec2_subnets: "{{ ec2_subnet_facts.subnets | shuffle(seed=ansible_facts.date_time.epoch) }}"
    ec2_subnets_sorted: "{{ ec2_subnet_facts.subnets | sort(attribute='availability_zone') }}"

