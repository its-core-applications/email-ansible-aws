---

- name: "Set egress.{{ subd }}"
  route53:
    command: "create"
    overwrite: true
    zone: "{{ subd }}"
    record: "egress.{{ subd }}"
    type: "A"
    ttl: 60
    value: "{{ groups.Class_egress | intersect(groups.Status_production) | map('extract', hostvars, 'private_ip_address') | join(', ') }}"
  when: groups.Class_egress | default([]) | intersect(groups.Status_production | default([])) | length > 0

