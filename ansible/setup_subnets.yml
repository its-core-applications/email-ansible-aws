---

- hosts: localhost
  become: false
  tasks:
    - name: "Gather facts about VPC subnets"
      ec2_vpc_subnet_facts:
        region: "{{ aws_region }}"
        profile: "{{ aws_profile[aws_status][aws_region] }}"
      register: subnet_facts

    - name: "Apply tags to subnets"
      ec2_tag:
        region: "{{ aws_region }}"
        profile: "{{ aws_profile[aws_status][aws_region] }}"
        resource: "{{ item.id }}"
        tags:
          Class: "{{ item.tags.Name | regex_replace('Subnet.*') | lower }}"
      loop: "{{ subnet_facts.subnets }}"
      loop_control:
        label: "{{ item.tags.Name }}"
