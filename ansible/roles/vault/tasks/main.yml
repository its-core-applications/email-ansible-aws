---

- name: Download vault
  get_url:
    url: https://releases.hashicorp.com/vault/0.7.0/vault_0.7.0_linux_amd64.zip
    dest: /var/tmp/vault.zip
    checksum: sha256:c6d97220e75335f75bd6f603bb23f1f16fe8e2a9d850ba59599b1a0e4d067aaa

- name: Install vault
  unarchive:
    src: /var/tmp/vault.zip
    dest: /usr/bin
    copy: false
  notify: Restart vault

- name: Configure vault server
  copy:
    dest: /etc/vault.hcl
    src: vault.hcl
    owner: root
    group: root
    mode: 0644
  notify: Restart vault

- name: Configure vault service
  copy:
    dest: /etc/systemd/system/vault.service
    src: vault.service
    owner: root
    group: root
    mode: 0644
  notify: Restart vault

- name: Enable vault service
  service:
    name: vault
    enabled: true

