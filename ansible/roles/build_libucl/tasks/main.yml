---

- name: Build libucl
  become: false
  block:
    - name: Clone libucl
      git:
        repo: https://github.com/vstakhov/libucl.git
        dest: ~/libucl
        update: true
        force: true
        version: "{{ libucl_version }}"

    - name: Build libucl tarball (autogen.sh)
      command: ./autogen.sh
      args:
        chdir: ~/libucl

    - name: Build libucl tarball (configure)
      command: ./configure
      args:
        chdir: ~/libucl

    - name: Build libucl tarball (make dist)
      make:
        chdir: ~/libucl
        target: dist

    - name: Move tarball into SOURCES
      shell: mv -f ~/libucl/libucl-{{ libucl_version }}.tar.xz ~/rpmbuild/SOURCES/

    - name: Install spec file
      template:
        dest: ~/libucl.spec
        src: libucl.spec.j2

    - name: Build libucl RPM
      command: rpmbuild -ba ~/libucl.spec

- import_role:
    name: localrepo_update
