---

- name: Install unbound 
  yum:
    name: unbound
    state: latest
  notify: Restart unbound 

- name: Configure unbound
  template:
    dest: /etc/unbound/unbound.conf
    src: unbound.conf.j2
    owner: root
    group: root
    mode: 0644
  notify: Restart unbound

- name: Enable unbound 
  service:
    name: unbound
    enabled: true

- meta: flush_handlers

- name: Set 127.0.0.1 as the active nameserver
  copy:
    dest: /etc/resolv.conf
    content: "nameserver 127.0.0.1\n"
    owner: root
    group: root
    mode: 0444
  tags: mutable

- name: Disable PEERDNS for eth0
  copy:
    dest: /etc/sysconfig/network-scripts/ifcfg-eth0
    src: ifcfg-eth0
    owner: root
    group: root
    mode: 0644

- name: Disable cloud-init network config
  copy:
    dest: /etc/cloud/cloud.cfg.d/99-network.cfg
    content: 'network: {config: disabled}'
    owner: root
    group: root
    mode: 0644

