- tags:
    - odm
  block:
    - name: Install ODM
      pip:
        name: git+https://github.com/flowerysong/ODM.git
        state: latest

    - name: Install quickxorhash
      yum:
        name: quickxorhash
        state: latest

    - name: Install ODM config files
      template:
        dest: /etc/{{ item }}
        src: "{{ item }}.j2"
        owner: root
        group: root
        mode: "0644"
      loop:
        - odm.umich.yaml
        - odm.5d55.yaml
      vars:
        odm_umich_idx: "{{ 1 + groups.Class_odm.index(inventory_hostname) }}"
        odm_5d55_idx: "{{ 6 + groups.Class_odm.index(inventory_hostname) }}"

    - name: Copy utility scripts
      copy:
        src: "{{ item }}"
        dest: /usr/local/bin/{{ item }}
        owner: root
        group: root
        mode: "0755"
      loop:
        - odm-download
        - odm-splitlist
        - migrate-tenants
        - gen-odm-file-stats
        - gen-odm-split-stats
