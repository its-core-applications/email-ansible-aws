---

- name: Install hostname data files
  copy:
    dest: "/usr/share/{{ item }}"
    src: "{{ item }}"
    owner: root
    group: root
    mode: 0644
  loop:
    - hostname-prefixes
    - hostname-suffixes
    - hostname-suffixes-builder
    - hostname-suffixes-egress
    - hostname-suffixes-mx
    - hostname-suffixes-mx-test
    - hostname-suffixes-relay
    - hostname-suffixes-smtp
    - hostname-suffixes-smtp-test

- name: Install script
  template:
    dest: /usr/local/sbin/dynhostname
    src: dynhostname.j2
    owner: root
    group: root
    mode: 0755

- name: Install systemd unit
  copy: 
    dest: /etc/systemd/system/dynhostname.service
    src: dynhostname.service
    owner: root
    group: root
    mode: 0644

- name: Enable dynhostname
  systemd:
    name: dynhostname
    enabled: true

- name: Schedule dynhostname public IP re-check
  copy:
    dest: /etc/cron.d/dynhostname
    src: dynhostname.cron
    owner: root
    group: root
    mode: 0644
