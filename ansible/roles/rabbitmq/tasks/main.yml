- tags:
    - rabbitmq
  block:
    - name: Configure PackageCloud repositories
      copy:
        dest: /etc/yum.repos.d/{{ item }}
        src: "{{ item }}"
        owner: root
        group: root
        mode: "0644"
      loop:
        - rabbitmq_rabbitmq-server.repo
        - rabbitmq_erlang.repo

    - name: Install RabbitMQ
      yum:
        name: rabbitmq-server
        state: latest
      notify: Restart RabbitMQ

    - name: Enable RabbitMQ
      systemd:
        name: rabbitmq-server
        daemon_reload: true
        enabled: true
      notify: Restart RabbitMQ

    - name: Start RabbitMQ
      systemd:
        name: rabbitmq-server
        state: started
