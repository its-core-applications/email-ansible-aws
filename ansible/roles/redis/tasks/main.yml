- tags:
    - redis
  block:
    - name: Install redis
      yum:
        name: redis
        state: latest
      notify: Restart redis

    - name: Configure redis
      template:
        dest: /etc/redis.conf
        src: redis.conf.j2
        owner: redis
        group: root
        mode: "0644"
      notify: Restart redis

    - name: Enable redis
      service:
        name: redis
        enabled: true
      notify: Restart redis

    - name: Install local monitoring scripts
      copy:
        dest: "{{ comint_base }}/{{ item }}"
        src: "{{ item }}"
        owner: collaborate
        group: collaborate
        mode: "0755"
      loop:
        - check-redis-cluster

    - name: Start redis
      systemd:
        name: redis
        state: started
