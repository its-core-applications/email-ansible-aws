---

- meta: flush_handlers

- name: Install build dependencies
  yum:
    pkg: "{{ item }}"
    state: latest
  with_items:
    - urcl-devel

- name: Clone penaltybox
  become: false 
  git:
    repo: https://github.com/simta/penaltybox.git
    dest: ~/penaltybox
    update: yes
    force: yes

- name: Build penaltybox RPM (autoreconf)
  become: false
  command: chdir=~/penaltybox autoreconf -fiv

- name: Build penaltybox RPM (configure)
  become: false
  command: chdir=~/penaltybox ./configure

- name: Build penaltybox RPM (make rpm)
  become: false
  command: chdir=~/penaltybox make rpm
  notify: Update yum repository
