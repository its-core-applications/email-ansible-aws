---

- tags:
    - dashboard
  block:
    - import_role:
        name: httpd

    - name: Install extra Apache modules
      yum:
        name:
          - mod_auth_openidc
          - mod_ldap
        state: present

    - name: Configure a vhost for dashboard.{{ subd }}
      template:
        dest: /etc/httpd/conf.d/dashboard.{{ subd }}.conf
        src: httpd.conf.j2
        owner: root
        group: root
        mode: "0644"
      notify: Restart httpd

    - import_role:
        name: letsencrypt
      vars:
        certificate: dashboard.{{ subd }}
        le_services:
          - httpd
