---

- name: Install specfile
  become: false
  copy: src=spamassassin.spec dest=~/spamassassin.spec
  tags: build 

- name: Fetch sources
  become: false
  shell: spectool -g -R ~/spamassassin.spec
  tags: build

- name: Install non-fetchable sources
  become: false
  copy: src=sources/{{ item }} dest=~/rpmbuild/SOURCES/{{ item }}
  with_items:
    - sa-update.cronscript
    - sa-update.crontab
    - sa-update.force-sysconfig
    - sa-update.logrotate
    - spamassassin-default.rc
    - spamassassin-helper.sh
    - spamassassin-official.conf
    - spamassassin-rawbody-split-documentation.patch
    - spamassassin.service
    - spamassassin-spamc.rc
    - spamassassin.sysconfig
  tags: build

- name: Install build dependencies
  shell: yum-builddep -y spamassassin
  tags: build

- name: Build SpamAssassin RPM
  become: false
  shell: rpmbuild -ba spamassassin.spec
  notify: Update yum repository
  tags: build
