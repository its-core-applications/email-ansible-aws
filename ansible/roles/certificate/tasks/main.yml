---

- name: Create certificate storage directory
  file:
    dest: /etc/pki/collab/private
    owner: root
    group: mail
    mode: 0750
    state: directory
  when: certificate_type != 'null'

- name: "{{ certificate }} : Install private key"
  copy:
    dest: "/etc/pki/collab/private/{{ certificate }}.key"
    content: "{{ lookup('hashi_vault', 'secret=secret/cert/' + certificate) }}"
    owner: root
    group: mail
    mode: 0640
  when: certificate_type != 'null'

- name: "{{ certificate }} : Install certificate"
  copy:
    dest: "/etc/pki/collab/private/{{ certificate }}.crt"
    content: "{{ lookup('hashi_vault', 'secret=secret/cert/' + certificate + '/certificate') }}"
    owner: root
    group: mail
    mode: 0644
  when: certificate_type == 'tls'
