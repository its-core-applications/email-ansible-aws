---

- name: s3upload
  find: paths="/home/ec2-user/rpmbuild/RPMS" patterns="*.rpm" recurse=yes
  register: find_rpm
  changed_when: true
  tags: s3
  notify: s3upload step 2

- name: s3upload step 2
  s3:
    bucket: "{{ yum_hostname }}"
    region: "{{ yum_aws_region }}"
    mode: put
    permission: public-read
    object: "{{ ansible_distribution | lower }}/{{ ansible_distribution_major_version }}/{{ item.path | basename }}"
    src: "{{ item.path }}"
    overwrite: never
  with_items: "{{ find_rpm.files }}"
  tags: s3
