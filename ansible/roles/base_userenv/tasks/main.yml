- name: Install user config files
  become: false
  tags:
    - base
    - base_userenv
  block:
    - name: Configure bash
      template:
        src: bashrc.j2
        dest: ~/.bashrc
        mode: "0644"

    - name: Configure vim
      copy:
        src: vimrc
        dest: ~/.vimrc

    - name: Create vim autoload directory
      file:
        dest: ~/.vim/autoload
        state: directory

    - name: Install vim-plug
      get_url:
        dest: ~/.vim/autoload/plug.vim
        url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
        mode: "0644"

    - name: Install vim plugins
      command: vim +'PlugInstall --sync' +qall

    - name: Create ssh directory
      file:
        dest: ~/.ssh
        state: directory
        mode: "0700"

    - name: Configure ssh
      template:
        src: ssh_config.j2
        dest: ~/.ssh/config
        mode: "0600"

    - name: Install ssh private key
      copy:
        content: "{{ lookup('flowerysong.hvault.kv', 'ssh/' ~ ansible_user).value }}"
        dest: ~/.ssh/id_rsa.ec2
        mode: "0400"
      when:
        - bootstrap == false
        - "'Class_bastion' in group_names"

    - name: Configure git
      copy:
        src: gitconfig
        dest: ~/.gitconfig

