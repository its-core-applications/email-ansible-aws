---

- hosts: localhost
  gather_facts: false
  become: false
  tasks:
    - name: Fetch zone list
      route53_facts:
        profile: "{{ aws_profile[aws_status].subd }}"
        query: hosted_zone
      register: r53_zones

    - include_tasks: task_cleanup_dns.yml
      vars:
        subd_zone: "{{ r53_zones.HostedZones | selectattr('Name', 'equalto', subd ~ '.') | first }}"
      loop: "{{ range(0, ((subd_zone.ResourceRecordSetCount / 25) | int)) | list }}"
      loop_control:
        loop_var: include_iteration
