---

- name: "Set rbldnsd.{{ subd }}"
  delegate_to: localhost
  become: false
  run_once: true
  route53:
    command: "create"
    overwrite: true
    zone: "{{ subd }}"
    record: "rbldnsd.{{ subd }}"
    type: "A"
    ttl: 60
    value: "{{ groups.tag_Class_rbl intersect(groups.tag_Status_production | default([])) | map('extract', hostvars, 'ec2_private_ip_address') | join(', ') }}"
  when: groups.tag_Class_rbl | intersect(groups.tag_Status_production | default([])) | length > 0

