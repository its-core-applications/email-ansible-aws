{
  "variables": {
    "aws_region": "us-west-2",
    "image_type": "base",
    "base_ami": "ami-775e4f16"
  },
  "provisioners": [
    {
      "type": "shell",
      "script": "packer/scripts/ansible.sh"
    },
    {
      "type": "ansible",
      "playbook_file": "ansible/{{ user `image_type` }}.yml",
      "groups": [
        "tag_Class_{{ user `image_type` }}",
        "tag_Status_development"
      ],
      "host_alias": "{{ user `image_type` }}"
    },
    {
      "type": "shell",
      "script": "packer/scripts/cleanup.sh"
    }
  ],
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "{{ user `aws_region` }}",
      "ami_name": "ami_rhel7_{{ user `image_type` }}_{{ timestamp }}",
      "instance_type": "t2.micro",
      "source_ami": "{{ user `base_ami` }}",
      "encrypt_boot": true,
      "ssh_username": "ec2-user",
      "ssh_keypair_name": "2015-10-16",
      "ssh_private_key_file": "id_rsa",
      "ssh_pty": true,
      "ami_block_device_mappings": [
        {
          "device_name": "/dev/sda1",
          "volume_type": "gp2",
          "encrypted": true,
          "delete_on_termination": true
        }
      ],
      "tags": {
        "os": "rhel",
        "image_type": "{{ user `image_type` }}"
      }
    }
  ]
}
